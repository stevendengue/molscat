      SUBROUTINE RDSIGU(ISIGU)
C  Copyright (C) 2019 J. M. Hutson & C. R. Le Sueur
C  Distributed under the GNU General Public License, version 3
      USE efvs
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
C  THIS ROUTINE LISTS/PUNCHES THE 'SAVED' CROSS SECTIONS FROM (ISIGU)
C  FORMAT MADE COMPATIBLE W/CURRENT VERSION APR 94 (S Green)
C  AND AGAIN BY JM Hutson MAR 07
C  AND AGAIN BY CR Le Sueur JUNE 17:
C     RECORD LENGTH CHANGED TO 240 TO ENABLE UPTO 11 EXTERNAL VARIABLES
C     TO BE WRITTEN
C
C  NOTE: BY-PASSED IN CURRENT VERSION OF MOLSCAT
C  THE SEEMINGLY COMPLICATED METHOD USED IS TO ASSURE ABILITY TO
C  RETRIEVE CROSS SECTIONS INDEPENDENTLY OF A SUCCESSFULLY TERMINATED
C  SCATTERING RUN BY SAVING ON (ISIGU) AS WELL AS IN MATRIX SIG().
C

      CHARACTER(1) A1(80),S,B,ST,EOF,CS
      CHARACTER(2) CLEN
      CHARACTER(50) F201,F202
      DATA B /' '/, ST /'*'/, EOF /'$'/
C
      WRITE(6,601)
  601 FORMAT(' ')
      READ(ISIGU,100,ERR=900,REC=1) A1,ISVEFV,NEFV,NEFVP
  100 FORMAT(80A1,2I2)
      IEFVST=MIN(1,ISVEFV)
      LENEFV=MAX(NEFVP-IEFVST+1,0)
      READ(ISIGU,101,ERR=900,REC=2) (EFVNAM(IEFV),EFVUNT(IEFV),
     1                               IEFV=IEFVST,MIN(NEFVP,IEFVST+7))
  101 FORMAT(9(A20,A6))
      I10=2
      IF (LENEFV.GT.8) THEN
        I10=I10+1
        READ(ISIGU,101,ERR=900,REC=I10)
     1      (EFVNAM(IEFV),EFVUNT(IEFV),IEFV=MIN(IEFVST+8,NEFVP),NEFVP)
      ENDIF

  201 FORMAT(A1,F17.7,2F15.7,I5,2I7,5X,2I5,E20.6,1X,A1)
  202 FORMAT(A1,F17.7,2F15.7,I5,2I7,5X,2I5,1P E20.6,1X,A1)
      WRITE(CLEN,'(I3)') LENEFV
      F201="(A1,F17.7,"//TRIM(CLEN)//"(1X,F15.7,1X),"//
     1     "I5,2I7,5X,2I5,E20.6,1X,A1)"
      F202="(A1,F17.7,"//TRIM(CLEN)//"(1X,F15.7,1X),"//
     1     "I5,2I7,5X,2I5,1P,E20.6,1X,A1)"
C
 1000 I10=I10+1
      READ(ISIGU,200,REC=I10) S
  200 FORMAT(A1)
      IF (S.EQ.EOF) RETURN
      IF (S.NE.ST) GOTO 1000

      IF (LENEFV.LE.0) THEN
        READ(ISIGU,201,REC=I10) S,E,F1,F2,I1,I2,I3,I4,I5,SIG,CS
        WRITE(6,202) B,E,F1,F2,I1,I2,I3,I4,I5,SIG,CS
      ELSE
        READ(ISIGU,FMT=F201,REC=I10) S,E,
     1                               (EFV(IEFV),IEFV=IEFVST,NEFV),
     2                               I1,I2,I3,I4,I5,SIG,CS
        WRITE(6,FMT=F202) B,E,(EFV(IEFV),IEFV=IEFVST,NEFV),
     2                    I1,I2,I3,I4,I5,SIG,CS
      ENDIF
C  PUNCH CHANNEL COMMENTED OUT IN THIS VERSION
C     IF (SIG.GT.0.D0 .AND. I4.NE.I5)
C    1    WRITE(7,600) S,E,F1,F2,I1,I2,I3,I4,I5,SIG,CS
      GOTO 1000

  900 WRITE(6,*) ' *** RDSIGU.  ERROR READING FILE',ISIGU
      RETURN
      END
